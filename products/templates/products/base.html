{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}Phantom Moto{% endblock %}</title>
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <meta name="description" content="{% block meta_description %}Find premium bike exhausts, handlebars, and more at PhantomMoto.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}bike accessories, exhaust, handlebars, PhantomMoto{% endblock %}">
    <meta property="og:title" content="{% block og_title %}PhantomMoto{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Find premium bike accessories...{% endblock %}">
    <meta property="og:image" content="{% static 'logo.png' %}">
    <meta name="robots" content="index, follow">
    <link rel="stylesheet" href="{% static 'css/output.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        overflow-x: hidden;
        padding-bottom: 70px !important;
      }
      main {
        flex: 1;
      }
      footer {
        background-color: #000;
        color: #ccc;
        padding: 1.5rem 1rem;
        text-align: center;
        width: 100%;
        font-size: 0.9rem;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
      }
      footer a {
        color: #ccc;
        text-decoration: underline;
      }
      footer a:hover {
        color: white;
        text-decoration: none;
      }
      @media (max-width: 640px) {
        footer {
          font-size: 0.85rem;
          padding: 1rem 0.5rem;
        }
      }
      #mobile-menu {
        background: #212121 !important;
      }
      #mobile-menu a {
        color: #fff !important;
        background: #212121 !important;
        padding: 10px 0;
        margin: 0 4px;
        display: block;
        transition: background 0.2s, color 0.2s;
      }
      #mobile-menu a:hover {
        background: #333 !important;
        color: #F97A00 !important;
      }
      .mobile-bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: #fff;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-around;
        align-items: center;
        z-index: 1000;
      }
      .mobile-bottom-nav .nav-item {
        flex: 1;
        text-align: center;
        color: #d1002a;
        text-decoration: none;
        font-size: 12px;
        padding: 6px 0;
      }
      .mobile-bottom-nav .nav-icon {
        display: block;
        font-size: 22px;
        margin-bottom: 2px;
      }
      .mobile-bottom-nav .nav-item.active,
      .mobile-bottom-nav .nav-item:active {
        color: #ff6600;
      }
      @media (min-width: 768px) {
        .mobile-bottom-nav { display: none; }
      }
      /* WhatsApp Floating Button */
      .whatsapp-float {
        position: fixed;
        right: 18px;
        bottom: 80px;
        background: #25d366;
        color: #fff;
        border-radius: 30px;
        padding: 10px 18px 10px 14px;
        font-size: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        z-index: 1100;
        display: flex;
        align-items: center;
        gap: 7px;
        text-decoration: none;
        font-weight: 600;
        transition: background 0.2s;
      }
      .whatsapp-float:hover {
        background: #128c7e;
        color: #fff;
        text-decoration: none;
      }
      @media (max-width: 767px) {
        .whatsapp-float { font-size: 18px; padding: 8px 14px 8px 12px; bottom: 70px; }
      }
    </style>
  </head>
  <body>
    <header class="w-full border-b border-gray-200 head">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
          <div id="logo-box">
            <img src="{% static 'logo.png' %}" alt="Logo" class="h-10 w-auto logo" />
          </div>
          <div class="hidden md:flex flex-1 justify-center px-4">
            <div class="w-full max-w-xl relative">
              <input type="text" name="search" id="search-input" placeholder="Search for products..." style="color: white;" autocomplete="off" class="w-full border border-white rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-red-400" />
              <div id="suggestions" class="absolute bg-white w-full rounded-md shadow-md z-50 hidden max-h-60 overflow-y-auto"></div>
              <div class="absolute top-2.5 left-3 text-gray-500">
                <i class="fas fa-search"></i>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-6 text-gray-800 text-xl icon-box">
            <a href="/"><i class="fas fa-home cursor-pointer"></i></a>
            <a href="{% url 'products:cart' %}" id="cart-icon" style="position: relative;">
              <i class="fa fa-shopping-cart"></i>
              <span id="cart-count-bubble" style="position: absolute;top: -6px;right: -10px;background: #ff4136;color: white;border-radius: 50%;padding: 3px 7px;font-size: 12px;display: none;">0</span>
            </a>
            <!-- Cart window (dropdown) -->
            <div id="cart-window" style="display:none;position:absolute;top:60px;right:30px;z-index:1000;background:#fff;border:1px solid #ddd;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,0.18);width:340px;max-width:95vw;min-height:80px;max-height:400px;overflow-y:auto;">
              <div style="padding:1rem 1rem 0.5rem 1rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;">
                <span style="font-weight:600;font-size:1.1em;">Your Cart</span>
                <button id="close-cart-window" style="background:none;border:none;font-size:1.2em;cursor:pointer;">&times;</button>
              </div>
              <div id="cart-window-content" style="padding:1rem;min-height:40px;text-align:center;color:#888;">Loading...</div>
              <div style="padding:0.5rem 1rem 1rem 1rem;text-align:right;">
                <a href="{% url 'products:cart' %}" style="background:#F97A00;color:#fff;padding:7px 18px;border-radius:5px;font-weight:600;text-decoration:none;">Go to Cart</a>
              </div>
            </div>
            <a href="{% url 'products:account' %}" title="My Account" class="text-gray-800 hover:text-red-600"><i class="fas fa-user-circle cursor-pointer"></i></a>
            <button id="menu-btn" class="md:hidden focus:outline-none"><i class="fas fa-bars text-2xl"></i></button>
          </div>
        </div>
        <div class="md:hidden mt-4 mb-2">
          <div class="w-full relative">
            <input type="text" name="search" id="search-machine" placeholder="Search for products..." autocomplete="off" style="color: white; border-color: white;" class="w-full border rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-red-400" />
            <div class="absolute top-2.5 left-3 text-white">
              <i class="fas fa-search"></i>
            </div>
            <div id="Msuggestions" class="absolute bg-white w-full rounded-md shadow-md z-50 hidden max-h-60 overflow-y-auto"></div>
          </div>
        </div>
      </div>
      <nav class="bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="hidden md:flex justify-between items-center gap-6 py-3 text-sm font-semibold text-gray-700">
            <a href="/" class="hover:text-red-600">Home</a>
            <a href="/products/" class="hover:text-red-600">All Products</a>
            <a href="/blog/" class="hover:text-red-600">Blog & Videos</a>
            <a href="/contact/" class="hover:text-red-600">Contact Us</a>
            <a href="#" class="hover:text-red-600">Track Order</a>
          </div>
          <div id="mobile-menu" class="hidden md:hidden flex-col py-4 space-y-3 text-sm font-semibold text-gray-700">
            <a href="/" class="hover:text-red-600">Home</a>
            <a href="/products/" class="hover:text-red-600">All Products</a>
            <a href="/blog/" class="hover:text-red-600">Blog & Videos</a>
            <a href="/contact/" class="hover:text-red-600">Contact Us</a>
            <a href="#" class="hover:text-red-600">Track Order</a>
          </div>
        </div>
      </nav>
    </header>

    <main>
      {% block content %}{% endblock %}
    </main>

    <!-- Bottom Navigation Bar (Mobile) -->
    <nav class="mobile-bottom-nav">
      <a href="/" class="nav-item">
        <span class="nav-icon"><i class="fa fa-home"></i></span>
        <span class="nav-label">Home</span>
      </a>
      <a href="/products/" class="nav-item">
        <span class="nav-icon"><i class="fa fa-th-large"></i></span>
        <span class="nav-label">Shop</span>
      </a>
      <a href="{% url 'products:cart' %}" class="nav-item">
        <span class="nav-icon"><i class="fa fa-shopping-cart"></i></span>
        <span class="nav-label">Cart</span>
      </a>
      <a href="{% url 'products:account' %}" class="nav-item">
        <span class="nav-icon"><i class="fa fa-user"></i></span>
        <span class="nav-label">Account</span>
      </a>
    </nav>
    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/8291056686" class="whatsapp-float" target="_blank" rel="noopener" aria-label="Chat on WhatsApp">
      <i class="fab fa-whatsapp"></i> Inquire Now !
    </a>
    <style>
      .whatsapp-float {
        position: fixed;
        right: 18px;
        bottom: 40%;
        background: #25d366;
        color: #fff;
        border-radius: 30px;
        padding: 10px 18px 10px 14px;
        font-size: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        z-index: 1100;
        display: flex;
        align-items: center;
        gap: 7px;
        text-decoration: none;
        font-weight: 600;
        transition: background 0.2s;
      }
      .whatsapp-float:hover {
        background: #128c7e;
        color: #fff;
        text-decoration: none;
      }
      @media (max-width: 767px) {
        .whatsapp-float { font-size: 18px; padding: 8px 14px 8px 12px; bottom: 40%; }
      }
    </style>
    <!-- Font Awesome already included in <head> -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const menuBtn = document.getElementById('menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        menuBtn.addEventListener('click', () => {
          if (mobileMenu.classList.contains('hidden')) {
            mobileMenu.classList.remove('hidden');
            mobileMenu.classList.add('flex');
          } else {
            mobileMenu.classList.remove('flex');
            mobileMenu.classList.add('hidden');
          }
        });

        // Hide mobile menu when clicking a link
        mobileMenu.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            mobileMenu.classList.remove('flex');
            mobileMenu.classList.add('hidden');
          });
        });

        // Mobile searchbar logic (full feature parity)
        const Minput = document.getElementById('search-machine');
        const MsuggestionsBox = document.getElementById('Msuggestions');
        if (Minput && MsuggestionsBox) {
          Minput.addEventListener('input', () => {
            const query = Minput.value.trim();
            if (query.length === 0) {
              MsuggestionsBox.classList.add('hidden');
              MsuggestionsBox.innerHTML = '';
              return;
            }
            fetch(`/search-suggestions/?q=${query}`)
              .then((res) => res.json())
              .then((data) => {
                MsuggestionsBox.innerHTML = '';
                if (data.results.length > 0) {
                  data.results.forEach((item) => {
                    const div = document.createElement('div');
                    div.innerHTML = `<span>${item.name}</span> <span style="float:right;font-size:0.92em;color:#888;">${item.type}</span>`;
                    div.className = 'px-4 py-2 hover:bg-gray-100 cursor-pointer';
                    div.addEventListener('click', () => {
                      if(item.kind === 'category') {
                        window.location.href = `/products/?category=${encodeURIComponent(item.name)}`;
                      } else if(item.kind === 'blog') {
                        window.location.href = `/blog/${item.id}/`;
                      } else if(item.kind === 'video') {
                        window.location.href = `/blog/#video-${item.id}`;
                      } else {
                        window.location.href = `/products/?search=${encodeURIComponent(item.name)}`;
                      }
                    });
                    MsuggestionsBox.appendChild(div);
                  });
                  MsuggestionsBox.classList.remove('hidden');
                } else {
                  MsuggestionsBox.classList.add('hidden');
                }
              });
          });
        }

        // Desktop searchbar logic
        const input = document.getElementById('search-input');
        const suggestionsBox = document.getElementById('suggestions');
        if (input && suggestionsBox) {
          input.addEventListener('input', () => {
            const query = input.value.trim();
            if (query.length === 0) {
              suggestionsBox.classList.add('hidden');
              suggestionsBox.innerHTML = '';
              return;
            }
            fetch(`/search-suggestions/?q=${query}`)
              .then((res) => res.json())
              .then((data) => {
                suggestionsBox.innerHTML = '';
                if (data.results.length > 0) {
                  data.results.forEach((item) => {
                    const div = document.createElement('div');
                    div.innerHTML = `<span>${item.name}</span> <span style="float:right;font-size:0.92em;color:#888;">${item.type}</span>`;
                    div.className = 'px-4 py-2 hover:bg-gray-100 cursor-pointer';
                    div.addEventListener('click', () => {
                      if(item.kind === 'category') {
                        window.location.href = `/products/?category=${encodeURIComponent(item.name)}`;
                      } else if(item.kind === 'blog') {
                        window.location.href = `/blog/${item.id}/`;
                      } else if(item.kind === 'video') {
                        window.location.href = `/blog/#video-${item.id}`;
                      } else {
                        window.location.href = `/products/?search=${encodeURIComponent(item.name)}`;
                      }
                    });
                    suggestionsBox.appendChild(div);
                  });
                  suggestionsBox.classList.remove('hidden');
                } else {
                  suggestionsBox.classList.add('hidden');
                }
              });
          });
        }

        // Cart window logic
        const cartIcon = document.getElementById('cart-icon');
        const cartWindow = document.getElementById('cart-window');
        const closeCartBtn = document.getElementById('close-cart-window');
        const cartContent = document.getElementById('cart-window-content');
        if(cartIcon && cartWindow && closeCartBtn && cartContent) {
          cartIcon.addEventListener('click', function(e) {
            e.preventDefault();
            if(cartWindow.style.display === 'none' || cartWindow.style.display === '') {
              cartWindow.style.display = 'block';
              // Fetch cart items via AJAX
              fetch('/ajax/cart/items/')
                .then(res => res.json())
                .then(data => {
                  if(data.items && data.items.length > 0) {
                    cartContent.innerHTML = data.items.map(item =>
                      `<div style='display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;'>
                        <span style='font-weight:500;'>${item.name}</span>
                        <span style='color:#888;'>x${item.quantity}</span>
                        <span style='font-weight:600;'>â‚¹${item.price}</span>
                      </div>`
                    ).join('');
                  } else {
                    cartContent.innerHTML = '<span>Your cart is empty.</span>';
                  }
                })
                .catch(() => {
                  cartContent.innerHTML = '<span style="color:red;">Error loading cart.</span>';
                });
            } else {
              cartWindow.style.display = 'none';
            }
          });
          closeCartBtn.addEventListener('click', function() {
            cartWindow.style.display = 'none';
          });
          // Hide cart window if clicking outside
          document.addEventListener('mousedown', function(event) {
            if(cartWindow.style.display === 'block' && !cartWindow.contains(event.target) && !cartIcon.contains(event.target)) {
              cartWindow.style.display = 'none';
            }
          });
        }
      });
    </script>
  </body>
</html>
