{% extends 'products/base.html' %}
{% block content %}
<div class="max-w-xl mx-auto mt-10 p-6 bg-white rounded shadow">
  <h2 class="text-2xl font-bold mb-4">Test iThink Logistics Shipping API</h2>
  <form id="logistics-form">
    <div class="mb-3">
      <label class="block font-semibold">Pickup Pincode</label>
      <input type="text" name="pickup_pincode" class="border rounded px-3 py-2 w-full" required />
    </div>
    <div class="mb-3">
      <label class="block font-semibold">Delivery Pincode</label>
      <input type="text" name="delivery_pincode" class="border rounded px-3 py-2 w-full" required />
    </div>
    <div class="mb-3">
      <label class="block font-semibold">Weight (grams)</label>
      <input type="number" name="weight" class="border rounded px-3 py-2 w-full" required />
    </div>
    <div class="mb-3">
      <label class="block font-semibold">COD Amount (0 for prepaid)</label>
      <input type="number" name="cod_amount" class="border rounded px-3 py-2 w-full" required />
    </div>
    <div class="mb-3">
      <label class="block font-semibold">Order Type</label>
      <select name="order_type" class="border rounded px-3 py-2 w-full">
        <option value="prepaid">Prepaid</option>
        <option value="cod">COD</option>
      </select>
    </div>
    <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded">Check Couriers</button>
  </form>
  <div id="courier-results" class="mt-6"></div>
</div>
<script>
document.getElementById('logistics-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const form = e.target;
  const data = {
    pickup_pincode: form.pickup_pincode.value,
    delivery_pincode: form.delivery_pincode.value,
    weight: form.weight.value,
    cod_amount: form.cod_amount.value,
    order_type: form.order_type.value,
  };
  document.getElementById('courier-results').innerHTML = 'Loading...';
  fetch('/logistics/available-carriers/', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      if (data.carriers.length === 0) {
        document.getElementById('courier-results').innerHTML = '<p>No couriers found for these details.</p>';
      } else {
        document.getElementById('courier-results').innerHTML =
          '<h3 class="font-bold mb-2">Available Couriers:</h3>' +
          '<ul class="space-y-2">' +
          data.carriers.map(c => `<li class="border rounded p-3"><b>${c.company_name}</b><br>Delivery: ${c.delivery_time}<br>Price: â‚¹${c.price}</li>`).join('') +
          '</ul>';
      }
    } else {
      document.getElementById('courier-results').innerHTML = '<p class="text-red-600">Error: ' + data.error + '</p>';
    }
  })
  .catch(() => {
    document.getElementById('courier-results').innerHTML = '<p class="text-red-600">Network error.</p>';
  });
});
</script>
{% endblock %}
